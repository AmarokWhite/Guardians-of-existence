<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GoE v1.3: Cosmic Rebirth</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/ui.css">
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui-layer">
        <div id="char-modal-overlay" class="hidden" onclick="if(event.target===this) UI.closeCharModal()">
            <div class="char-modal">
                <div class="close-btn" onclick="UI.closeCharModal()">×</div>
                <div id="modal-content"></div>
            </div>
        </div>

        <div id="start-screen" class="menu-panel interactive">
            <h2 style="border:none; margin-bottom:10px;">СПОСОБ УПРАВЛЕНИЯ</h2>
            <p style="margin-bottom:30px;">Выберите удобный для вас вариант</p>
            <div style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap;">
                <button class="btn" onclick="GameState.setControl('mobile')">СЕНСОР</button>
                <button class="btn" onclick="GameState.setControl('pc')">КЛАВИАТУРА И МЫШЬ</button>
            </div>
        </div>

        <div id="main-menu" class="menu-panel interactive hidden">
            <h1>GUARDIANS<br><span style="font-size:24px; color:#aaa; text-shadow:none; letter-spacing:12px; font-weight:300; -webkit-text-fill-color: #aaa;">OF EXISTENCE</span></h1>
            <p style="color:#00bfff; font-size:14px; margin-top:-10px; margin-bottom: 25px; font-weight:bold; letter-spacing:2px;">ВЕРСИЯ 1.3: COSMIC REBIRTH</p>
            
            <div style="display:flex; flex-direction:column; align-items:center; width: 100%;">
                <button class="btn" style="width:280px;" onclick="UI.showScreen('mode-select')">ИГРАТЬ</button>
                <button class="btn" style="width:280px;" onclick="UI.showScreen('char-select')">ГЕРОИ</button>
                <button class="btn" style="width:280px;" onclick="UI.showScreen('achievements-menu')">ДОСТИЖЕНИЯ</button>
                <button class="btn btn-red" style="width:280px;" onclick="UI.showScreen('settings-menu')">НАСТРОЙКИ</button>
            </div>
        </div>
        
        <div id="settings-menu" class="menu-panel interactive hidden">
            <h2>НАСТРОЙКИ</h2>
            <p>Звук: <span style="color:#555">Выкл (Beta)</span></p>
            <button class="btn" onclick="Storage.saveGame(); UI.showScreen('main-menu')" style="margin-top:20px;">НАЗАД</button>
        </div>

        <div id="currency-display" class="hidden">★ <span id="stars-val">0</span></div>

        <div id="achievements-menu" class="menu-panel interactive hidden">
            <h2>ТРОФЕИ КОСМОСА</h2>
            <div id="ach-list" style="width:100%; max-height:350px; overflow-y:auto; text-align:left;"></div>
            <button class="btn" onclick="UI.showScreen('main-menu')" style="margin-top:20px;">НАЗАД</button>
        </div>

        <div id="char-select" class="menu-panel interactive hidden">
            <h2>АРСЕНАЛ ЗАЩИТНИКОВ</h2>
            <p style="font-size:14px; margin-bottom:20px;">Нажмите на карту героя для подробностей</p>
            <div id="char-list" class="char-grid"></div>
            <button class="btn" onclick="UI.showScreen('main-menu')" style="margin-top:25px;">НАЗАД</button>
        </div>

        <div id="mode-select" class="menu-panel interactive hidden">
            <h2>ВЫБОР МИССИИ</h2>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; max-width:700px; margin:0 auto;">
                <button class="btn" onclick="Game.startGame('defense')">ЗАЩИТА МИРОВ<br><span style="font-size:11px; opacity:0.7;">Экшен RPG</span></button>
                <button class="btn" onclick="Game.startGame('td')">ПАРАДОКС ВРЕМЕНИ<br><span style="font-size:11px; opacity:0.7;">Стратегия (TD)</span></button>
                <button class="btn" onclick="Game.startGame('jump')">СИНГУЛЯРНОСТЬ<br><span style="font-size:11px; opacity:0.7;">Космо-Джамп</span></button>
                <button class="btn btn-red" onclick="Game.startGame('boss')">УБИЙЦА БОГОВ<br><span style="font-size:11px; opacity:0.7;">Босс-Рейд</span></button>
            </div>
            <button class="btn" onclick="UI.showScreen('main-menu')" style="margin-top:20px; width:100%;">НАЗАД</button>
        </div>

        <div id="game-over" class="menu-panel interactive hidden">
            <h2 id="go-title" style="border:none; font-size:40px;">СТАТУС</h2>
            <p id="go-msg" style="font-size:24px; color:#fff; margin:20px 0;">...</p>
            <button class="btn" onclick="Game.returnToMenu()">В МЕНЮ</button>
        </div>
    </div>

    <div id="hud" class="hidden">
        <div id="stats-display" class="hud-block">
            <span id="stat-1">HP: 100</span> <br> <span id="stat-2" style="font-size:14px; color:#aaa;">Волна: 1</span>
        </div>
        <div id="boss-bar-container"><div id="boss-bar-fill"></div></div>

        <div id="mobile-controls" class="hidden">
            <div id="joystick-area"><div id="joystick-knob"></div></div>
            <div id="action-buttons">
                <div id="btn-skill" class="action-btn skill">УЛЬТА</div>
                <div id="btn-atk" class="action-btn big">АТАКА</div>
            </div>
        </div>
        
        <div id="td-ui" class="hidden" style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; pointer-events: auto; background: rgba(10,12,18,0.95); padding: 10px; border: 1px solid #444; z-index: 15; overflow-x: auto; max-width: 95%; border-radius: 12px;"></div>
        
        <div id="upgrade-panel" style="position: absolute; bottom: 140px; left: 50%; transform: translateX(-50%); background: rgba(10,15,20,0.95); padding: 15px; border: 2px solid #00bfff; border-radius: 12px; text-align: center; pointer-events: auto; display: none; z-index: 25; width: 220px; box-shadow: 0 0 30px rgba(0,0,0,0.8);">
            <div id="upg-info" style="color:#fff; margin-bottom:15px; font-weight:900; font-size:16px;">Ур. 1</div>
            <button class="btn" style="width:100%; font-size:14px; padding:10px; margin:0;" onclick="TD.upgradeSelectedTower()">УЛУЧШИТЬ (<span id="upg-cost">150</span>$)</button>
            <button class="btn btn-red" style="width:100%; font-size:14px; padding:10px; margin:10px 0 0 0;" onclick="TD.deselectTower()">ЗАКРЫТЬ</button>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>